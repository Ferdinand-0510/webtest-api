{"ast":null,"code":"import React,{useState}from'react';import axios from'axios';import'./InputImg.css';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function InputImg(){const[image,setImage]=useState(`http://localhost:5000/images/market.jpg`);const[showModal,setShowModal]=useState(false);const[fileInput,setFileInput]=useState(null);const[timestamp,setTimestamp]=useState(Date.now());// 添加時間戳狀態\n// 處理圖片上傳\nconst handleImageUpload=async e=>{const file=e.target.files[0];if(file){try{// 創建 FormData\nconst formData=new FormData();formData.append('file',file);formData.append('Title','HomeTitle');formData.append('TitleImg',file.name);formData.append('Title_Status','1');// 發送請求到後端\nconst response=await axios.post('http://localhost:5000/api/Change_HomeImg',formData,{headers:{'Content-Type':'multipart/form-data'}});if(response.data.success){// 更新時間戳來強制重新加載圖片\nsetTimestamp(Date.now());// 使用新的時間戳更新圖片URL\nsetImage(`/images/market.jpg?t=${Date.now()}`);alert('圖片上傳成功！');}else{throw new Error(response.data.message||'上傳失敗');}}catch(error){var _error$response,_error$response$data;console.error('上傳失敗:',error);alert('上傳失敗: '+(((_error$response=error.response)===null||_error$response===void 0?void 0:(_error$response$data=_error$response.data)===null||_error$response$data===void 0?void 0:_error$response$data.error)||error.message));}}};// 觸發檔案選擇\nconst handleButtonClick=()=>{if(fileInput){fileInput.click();}};// 構建帶有時間戳的圖片URL\nconst getImageUrl=()=>`${image}?t=${timestamp}`;return/*#__PURE__*/_jsxs(\"div\",{className:\"Backstageinput-img-container\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"Backstageimage-container\",children:[/*#__PURE__*/_jsx(\"img\",{src:getImageUrl(),alt:\"Title Image\",className:\"Backstagetitle-image\",onClick:()=>setShowModal(true)}),/*#__PURE__*/_jsxs(\"div\",{className:\"image-overlay\",children:[/*#__PURE__*/_jsx(\"input\",{type:\"file\",ref:setFileInput,accept:\"image/*\",onChange:handleImageUpload,style:{display:'none'}}),/*#__PURE__*/_jsx(\"button\",{className:\"change-image-btn\",onClick:handleButtonClick,children:\"\\u66F4\\u63DB\\u5716\\u7247\"})]})]}),showModal&&/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",onClick:()=>setShowModal(false),children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsx(\"span\",{className:\"close-btn\",onClick:()=>setShowModal(false),children:\"\\xD7\"}),/*#__PURE__*/_jsx(\"img\",{src:getImageUrl(),alt:\"\\u9810\\u89BD\",className:\"modal-image\"})]})})]});}export default InputImg;","map":{"version":3,"names":["React","useState","axios","jsx","_jsx","jsxs","_jsxs","InputImg","image","setImage","showModal","setShowModal","fileInput","setFileInput","timestamp","setTimestamp","Date","now","handleImageUpload","e","file","target","files","formData","FormData","append","name","response","post","headers","data","success","alert","Error","message","error","_error$response","_error$response$data","console","handleButtonClick","click","getImageUrl","className","children","src","alt","onClick","type","ref","accept","onChange","style","display","stopPropagation"],"sources":["C:/類D槽/Python/StockWeb/webtest/src/pages/Page1/HomeData/components/InputImg.js"],"sourcesContent":["import React, { useState } from 'react';\r\nimport axios from 'axios';\r\nimport './InputImg.css';\r\n\r\nfunction InputImg() {\r\n    const [image, setImage] = useState(`http://localhost:5000/images/market.jpg`);\r\n    const [showModal, setShowModal] = useState(false);\r\n    const [fileInput, setFileInput] = useState(null);\r\n    const [timestamp, setTimestamp] = useState(Date.now()); // 添加時間戳狀態\r\n\r\n    // 處理圖片上傳\r\n    const handleImageUpload = async (e) => {\r\n        const file = e.target.files[0];\r\n        if (file) {\r\n            try {\r\n                // 創建 FormData\r\n                const formData = new FormData();\r\n                formData.append('file', file);\r\n                formData.append('Title', 'HomeTitle');\r\n                formData.append('TitleImg', file.name);\r\n                formData.append('Title_Status', '1');\r\n\r\n                // 發送請求到後端\r\n                const response = await axios.post('http://localhost:5000/api/Change_HomeImg', formData, {\r\n                    headers: {\r\n                        'Content-Type': 'multipart/form-data'\r\n                    }\r\n                });\r\n\r\n                if (response.data.success) {\r\n                    // 更新時間戳來強制重新加載圖片\r\n                    setTimestamp(Date.now());\r\n                    // 使用新的時間戳更新圖片URL\r\n                    setImage(`/images/market.jpg?t=${Date.now()}`);\r\n                    alert('圖片上傳成功！');\r\n                } else {\r\n                    throw new Error(response.data.message || '上傳失敗');\r\n                }\r\n            } catch (error) {\r\n                console.error('上傳失敗:', error);\r\n                alert('上傳失敗: ' + (error.response?.data?.error || error.message));\r\n            }\r\n        }\r\n    };\r\n\r\n    // 觸發檔案選擇\r\n    const handleButtonClick = () => {\r\n        if (fileInput) {\r\n            fileInput.click();\r\n        }\r\n    };\r\n\r\n    // 構建帶有時間戳的圖片URL\r\n    const getImageUrl = () => `${image}?t=${timestamp}`;\r\n\r\n    return (\r\n        <div className=\"Backstageinput-img-container\">\r\n            <div className=\"Backstageimage-container\">\r\n                <img \r\n                    src={getImageUrl()} \r\n                    alt=\"Title Image\" \r\n                    className=\"Backstagetitle-image\" \r\n                    onClick={() => setShowModal(true)}\r\n                />\r\n                <div className=\"image-overlay\">\r\n                    <input\r\n                        type=\"file\"\r\n                        ref={setFileInput}\r\n                        accept=\"image/*\"\r\n                        onChange={handleImageUpload}\r\n                        style={{ display: 'none' }}\r\n                    />\r\n                    <button \r\n                        className=\"change-image-btn\"\r\n                        onClick={handleButtonClick}\r\n                    >\r\n                        更換圖片\r\n                    </button>\r\n                </div>\r\n            </div>\r\n\r\n            {showModal && (\r\n                <div className=\"modal-overlay\" onClick={() => setShowModal(false)}>\r\n                    <div className=\"modal-content\" onClick={e => e.stopPropagation()}>\r\n                        <span className=\"close-btn\" onClick={() => setShowModal(false)}>\r\n                            &times;\r\n                        </span>\r\n                        <img src={getImageUrl()} alt=\"預覽\" className=\"modal-image\" />\r\n                    </div>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default InputImg;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}